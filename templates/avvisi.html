<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Link Utili - Castelli Romani MTB</title>
  <link rel="icon" href="https://em-content.zobj.net/thumbs/120/apple/354/mountain_26f0-fe0f.png" type="image/png">
  <style>
    body { 
      font-family: Arial, sans-serif; 
      margin: 0;
      padding: 15px; 
      background-color: #ecf0f1;
    }
    
    .header {
      max-width: 1000px;
      margin: 0 auto 15px auto;
      text-align: center;
    }
    
    h1 { 
      color: #2c3e50;
      margin-bottom: 8px;
    }
    
    .subtitle {
      color: #7f8c8d;
      font-size: 14px;
      margin-bottom: 15px;
    }
    
    .back-button {
      display: inline-block;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 10px 25px;
      border-radius: 25px;
      text-decoration: none;
      font-weight: bold;
      font-size: 14px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
      transition: transform 0.2s;
    }
    
    .back-button:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 12px rgba(0,0,0,0.15);
    }
    
    .last-update {
      text-align: center;
      color: #95a5a6;
      font-size: 12px;
      margin-bottom: 20px;
    }
    
    .section-box {
      max-width: 1000px;
      margin: 15px auto;
      padding: 15px;
      background: white;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    
    .section-box.highlight {
      border: 2px solid #27ae60;
    }
    
    .section-box h3 {
      color: #2c3e50;
      margin: 0 0 12px 0;
      font-size: 18px;
    }
    
    .section-box.highlight h3 {
      color: #27ae60;
    }
    
    .section-box p {
      margin: 8px 0;
      font-size: 14px;
      color: #555;
      line-height: 1.5;
    }
    
    /* Form Button */
    .form-button {
      display: inline-block;
      background: #27ae60;
      color: white;
      padding: 12px 30px;
      font-size: 16px;
      font-weight: bold;
      border-radius: 30px;
      text-decoration: none;
      box-shadow: 0 4px 10px rgba(0,0,0,0.15);
      transition: all 0.2s;
      margin: 15px 0;
    }
    
    .form-button:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 15px rgba(0,0,0,0.2);
    }
    
    /* Feedback Cards */
    .feedback-list {
      margin-top: 20px;
    }
    
    .feedback-card {
      background: #f8f9fa;
      border-left: 4px solid #27ae60;
      padding: 12px;
      margin-bottom: 10px;
      border-radius: 4px;
    }
    
    .feedback-header {
      display: flex;
      justify-content: space-between;
      margin-bottom: 8px;
    }
    
    .feedback-location {
      font-weight: bold;
      color: #2c3e50;
      font-size: 14px;
    }
    
    .feedback-date {
      font-size: 12px;
      color: #7f8c8d;
    }
    
    .feedback-description {
      font-size: 13px;
      color: #555;
      margin: 5px 0;
    }
    
    /* Work in Progress Items */
    .wip-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 12px;
      margin-top: 12px;
    }
    
    .wip-item {
      padding: 12px;
      background: #f8f9fa;
      border-radius: 6px;
      border-left: 3px solid #95a5a6;
      text-align: center;
    }
    
    .wip-item .icon {
      font-size: 24px;
      margin-bottom: 5px;
    }
    
    .wip-item .title {
      font-weight: bold;
      color: #2c3e50;
      font-size: 14px;
      margin-bottom: 3px;
    }
    
    .wip-item .status {
      font-size: 12px;
      color: #95a5a6;
      font-style: italic;
    }
    
    /* Emergency Box - COMPATTO */
    .emergency-box {
      max-width: 1000px;
      margin: 15px auto;
      padding: 12px 15px;
      background: #fff3cd;
      border: 2px solid #ffc107;
      border-radius: 8px;
      text-align: center;
    }
    
    .emergency-box h3 {
      color: #856404;
      margin: 0 0 10px 0;
      font-size: 16px;
    }
    
    .emergency-box p {
      color: #856404;
      margin: 5px 0;
      font-size: 13px;
    }
    
    .emergency-number {
      font-size: 20px;
      font-weight: bold;
      color: #e74c3c;
    }
    
    /* Links Grid */
    .links-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 12px;
      margin-top: 12px;
    }
    
    .link-item {
      padding: 12px;
      background: #f8f9fa;
      border-radius: 6px;
      border-left: 3px solid #3498db;
    }
    
    .link-item a {
      color: #3498db;
      text-decoration: none;
      font-weight: bold;
      font-size: 14px;
      display: block;
      margin-bottom: 5px;
    }
    
    .link-item a:hover {
      text-decoration: underline;
    }
    
    .link-item p {
      margin: 5px 0 0 0;
      font-size: 12px;
      color: #7f8c8d;
    }
    
    /* Section Title */
    .section-title {
      max-width: 1000px;
      margin: 25px auto 15px auto;
      padding: 12px 15px;
      background: white;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    
    .section-title h2 {
      margin: 0;
      color: #2c3e50;
      font-size: 18px;
      border-left: 4px solid #3498db;
      padding-left: 12px;
    }
    
    /* Info Box - Compatto */
    .info-box {
      max-width: 1000px;
      margin: 15px auto;
      padding: 15px;
      background: #e3f2fd;
      border-left: 4px solid #2196f3;
      border-radius: 8px;
    }
    
    .info-box h3 {
      color: #1565c0;
      margin: 0 0 10px 0;
      font-size: 16px;
    }
    
    .info-box p {
      color: #424242;
      line-height: 1.5;
      margin: 8px 0;
      font-size: 13px;
    }
    
    .info-box ul {
      margin: 8px 0;
      padding-left: 20px;
    }
    
    .info-box li {
      margin: 5px 0;
      font-size: 13px;
      color: #424242;
    }
    
    /* Keywords Box */
    .keywords-box {
      background: #f8f9fa;
      padding: 12px;
      border-radius: 6px;
      margin-top: 10px;
    }
    
    .keywords-box strong {
      color: #2c3e50;
    }
    
    .keywords-box ul {
      margin: 8px 0;
      color: #555;
    }
    

    /* Report Form GPS */
    .report-form {
      margin-top: 12px;
    }
    .gps-status {
      display: flex; align-items: center; gap: 8px;
      padding: 10px 14px; border-radius: 8px;
      background: #f8f9fa; border: 1px solid #dee2e6;
      font-size: 13px; margin-bottom: 14px;
    }
    .gps-dot {
      width: 10px; height: 10px; border-radius: 50%;
      background: #95a5a6; flex-shrink: 0;
      transition: background 0.3s;
    }
    .gps-dot.acquiring { background: #f7b733; animation: pulse 1s infinite; }
    .gps-dot.ready     { background: #27ae60; }
    .gps-dot.error     { background: #e74c3c; }
    @keyframes pulse { 0%,100%{opacity:1} 50%{opacity:0.4} }

    .kind-grid {
      display: grid; grid-template-columns: 1fr 1fr;
      gap: 8px; margin-bottom: 12px;
    }
    .kind-btn {
      padding: 10px 8px; border-radius: 8px; border: 2px solid #dee2e6;
      background: white; cursor: pointer; font-size: 13px; font-weight: bold;
      text-align: center; transition: all 0.15s; color: #2c3e50;
    }
    .kind-btn:hover       { border-color: #3498db; background: #f0f8ff; }
    .kind-btn.selected    { color: white; border-color: transparent; }
    .kind-btn.sel-ok      { background: #27ae60; }
    .kind-btn.sel-muddy   { background: #f7b733; }
    .kind-btn.sel-closed  { background: #e74c3c; }
    .kind-btn.sel-danger  { background: #e67e22; }

    .report-desc {
      width: 100%; padding: 10px 12px; border-radius: 8px;
      border: 1px solid #dee2e6; font-size: 13px; font-family: Arial, sans-serif;
      resize: vertical; min-height: 70px; box-sizing: border-box;
      margin-bottom: 12px;
    }
    .report-desc:focus { outline: none; border-color: #3498db; }

    .submit-btn {
      width: 100%; padding: 12px; border-radius: 25px;
      background: #27ae60; color: white; border: none;
      font-size: 15px; font-weight: bold; cursor: pointer;
      transition: all 0.2s; box-shadow: 0 4px 10px rgba(0,0,0,0.15);
    }
    .submit-btn:hover:not(:disabled) { background: #219a52; transform: translateY(-1px); }
    .submit-btn:disabled { background: #95a5a6; cursor: not-allowed; transform: none; }

    .submit-result {
      margin-top: 10px; padding: 10px 14px; border-radius: 8px;
      font-size: 13px; font-weight: bold; display: none; text-align: center;
    }
    .submit-result.success { background: #d4edda; color: #155724; }
    .submit-result.error   { background: #f8d7da; color: #721c24; }

    /* Report markers list */
    .report-card {
      background: #f8f9fa; border-radius: 6px;
      padding: 10px 12px; margin-bottom: 8px;
      display: flex; align-items: flex-start; gap: 10px;
    }
    .report-icon { font-size: 20px; flex-shrink: 0; }
    .report-body { flex: 1; }
    .report-kind { font-weight: bold; font-size: 13px; color: #2c3e50; }
    .report-desc-text { font-size: 12px; color: #555; margin-top: 2px; }
    .report-meta { font-size: 11px; color: #95a5a6; margin-top: 4px; }
    .report-expiry { 
      font-size: 10px; color: #bdc3c7; 
      background: #ecf0f1; padding: 2px 6px; border-radius: 10px;
    }

    @media (max-width: 768px) {
      .wip-grid, .links-grid { grid-template-columns: 1fr; }
      .feedback-header { flex-direction: column; }
      .kind-grid { grid-template-columns: 1fr 1fr; }
    }
  </style>
</head>
<body>
  <div class="header">
    <h1>üîó Link Utili</h1>
    <div class="subtitle">Castelli Romani - Fonti ufficiali e segnalazioni community</div>
    <a href="/" class="back-button">‚Üê Torna alle Previsioni Meteo</a>
    <a href="/percorsi" class="back-button">üó∫Ô∏è Percorsi</a>
  </div>
  
  <div class="last-update">
    üìÖ Pagina aggiornata: <span id="currentTime"></span>
  </div>
 
  <!-- 1. SEGNALA CHIUSURE -->
  <div class="section-box highlight">
    <h3>üìç Segnala Condizioni Sentiero</h3>
    <p>Anonimo ‚Äî la posizione GPS viene rilevata automaticamente dal tuo dispositivo.</p>

    <div class="report-form">
      <!-- Stato GPS -->
      <div class="gps-status" id="gpsStatus">
        <div class="gps-dot acquiring" id="gpsDot"></div>
        <span id="gpsText">Rilevamento posizione in corso...</span>
      </div>

      <!-- Tipo segnalazione -->
      <div class="kind-grid">
        <button class="kind-btn" data-kind="ok"     onclick="selectKind(this)">üü¢ Sentiero OK</button>
        <button class="kind-btn" data-kind="muddy"  onclick="selectKind(this)">üü° Fangoso / Bagnato</button>
        <button class="kind-btn" data-kind="closed" onclick="selectKind(this)">üî¥ Chiuso / Bloccato</button>
        <button class="kind-btn" data-kind="danger" onclick="selectKind(this)">‚ö†Ô∏è Pericolo</button>
      </div>

      <!-- Descrizione -->
      <textarea class="report-desc" id="reportDesc" oninput="updateSubmitBtn()" 
        placeholder="Descrizione obbligatoria ‚Äî es: albero caduto al km 3, molto fango dopo la curva..." required></textarea>

      <!-- Invia -->
      <button class="submit-btn" id="submitBtn" onclick="submitReport()" disabled>
        üì§ Invia Segnalazione
      </button>
      <div class="submit-result" id="submitResult"></div>
    </div>

    <!-- SEGNALAZIONI ATTIVE -->
    <div style="margin-top: 20px;">
      <h4 style="color:#27ae60; margin: 0 0 12px 0; font-size: 16px;">
        üìã Segnalazioni Attive
        <span style="font-size:12px; color:#95a5a6; font-weight:normal;">
          ‚Äî rimangono per 21 giorni
        </span>
      </h4>
      {% if reports and reports|length > 0 %}
        {% for r in reports %}
        {% set icons = {"ok": "üü¢", "muddy": "üü°", "closed": "üî¥", "danger": "‚ö†Ô∏è"} %}
        {% set labels = {"ok": "Sentiero OK", "muddy": "Fangoso / Bagnato", "closed": "Chiuso / Bloccato", "danger": "Pericolo"} %}
        <div class="report-card">
          <div class="report-icon">{{ icons.get(r.kind, "üìç") }}</div>
          <div class="report-body">
            <div class="report-kind">{{ labels.get(r.kind, r.kind) }}</div>
            {% if r.description %}
            <div class="report-desc-text">{{ r.description }}</div>
            {% endif %}
            <div class="report-meta">
              üìå {{ r.lat | round(4) }}¬∞N {{ r.lon | round(4) }}¬∞E &nbsp;¬∑&nbsp;
              üïê {{ r.created_at[:10] }}
              <span class="report-expiry">scade {{ r.expires_at[:10] }}</span>
            </div>
          </div>
        </div>
        {% endfor %}
      {% else %}
        <p style="color:#95a5a6; font-size:13px;">Nessuna segnalazione attiva al momento.</p>
      {% endif %}
    </div>
  </div>

  <!-- 2. WORK IN PROGRESS -->
  <div class="section-box">
    <h3>üöß Integrazioni in Sviluppo</h3>
    <div class="wip-grid">
      <div class="wip-item">
        <div class="icon">üöµ</div>
        <div class="title">Trailforks</div>
        <div class="status">Work In Progress</div>
      </div>
    </div>
  </div>
  
<!-- 3. NUMERI EMERGENZA - RIDOTTO -->
  <div class="emergency-box">
    <h3>üö® Numeri di Emergenza</h3>
    <p>Soccorso Alpino: <span class="emergency-number">118</span> ‚Ä¢ 
       Incendi: <span class="emergency-number">1515</span> ‚Ä¢ 
       Forestali Rocca di Papa: <strong>06 9499035</strong></p>
  </div>
  
  <!-- 4. FONTI UFFICIALI -->
  <div class="section-title">
    <h2>üîó Fonti Ufficiali da Controllare</h2>
  </div>
  
  <!-- 5. PARCO + CONTATTI + ALBI PRETORI -->
  <div class="section-box">
    <h3>üèûÔ∏è Parco Regionale dei Castelli Romani</h3>
    <p>Sito ufficiale del Parco con ordinanze, divieti e comunicazioni ufficiali</p>
    <div class="links-grid">
      <div class="link-item">
        <a href="https://www.parcocastelliromani.it" target="_blank">üå≤ Sito Ufficiale Parco</a>
        <p>Ordinanze e comunicazioni ufficiali</p>
      </div>
      <div class="link-item">
        <a href="/cdn-cgi/l/email-protection#7e0e0c110a111d111212113e0e1f0c1d111d1f0d0a1b1212170c11131f101750170a">üìß <span class="__cf_email__" data-cfemail="2454564b504b474b48484b64544556474b474557504148484d564b49454a4d0a4d50">[email&#160;protected]</span></a>
        <p>Per segnalazioni e comunicazioni ufficiali</p>
      </div>
      <div class="link-item">
        <a href="tel:+3906947993">‚òéÔ∏è +39 06 9479931</a>
        <p>Via Cesare Battisti ‚Äî Rocca di Papa (RM)</p>
      </div>
    </div>
  </div>

  <!-- 6. ALBI PRETORI COMUNI -->
  <div class="section-box">
    <h3>üìú Albi Pretori dei Comuni del Parco</h3>
    <p style="font-size:13px; color:#7f8c8d; margin-bottom:12px;">
      Cerca le parole chiave: <em>"taglio boschivo"</em>, <em>"chiusura sentiero"</em>, <em>"ordinanza"</em>, <em>"lavori forestali"</em>
    </p>
    <div class="links-grid">
      <div class="link-item">
        <a href="https://www.comune.roccadipapa.rm.it/albo-pretorio/" target="_blank">üìã Rocca di Papa</a>
        <p>Sede del Parco</p>
      </div>
      <div class="link-item">
        <a href="https://www.comune.frascati.rm.it/pagina20727_albo-pretorio-on-line.html" target="_blank">üìã Frascati</a>
        <p>Area tuscolana</p>
      </div>
      <div class="link-item">
        <a href="https://www.comune.grottaferrata.rm.it/it/amministrazione/documenti/albo/atti" target="_blank">üìã Grottaferrata</a>
        <p>Area tuscolana</p>
      </div>
      <div class="link-item">
        <a href="https://www.comune.roccapriora.rm.it/" target="_blank">üìã Rocca Priora</a>
        <p>Area tuscolana</p>
      </div>
      <div class="link-item">
        <a href="https://comune.albanolaziale.rm.it" target="_blank">üìã Albano Laziale</a>
        <p>Area albana</p>
      </div>
      <div class="link-item">
        <a href="https://www.comune.castelgandolfo.rm.it" target="_blank">üìã Castel Gandolfo</a>
        <p>Area albana</p>
      </div>
      <div class="link-item">
        <a href="https://www.comune.ariccia.rm.it" target="_blank">üìã Ariccia</a>
        <p>Area albana</p>
      </div>
      <div class="link-item">
        <a href="https://www.comune.marino.rm.it" target="_blank">üìã Marino</a>
        <p>Area tuscolana/albana</p>
      </div>
      <div class="link-item">
        <a href="https://www.comune.nemi.rm.it" target="_blank">üìã Nemi</a>
        <p>Area lanuvina</p>
      </div>
      <div class="link-item">
        <a href="https://www.albopretorionline.it/velletri/alboente.aspx" target="_blank">üìã Velletri</a>
        <p>Area artemisia</p>
      </div>
      <div class="link-item">
        <a href="https://www.comune.genzanodiroma.rm.it" target="_blank">üìã Genzano di Roma</a>
        <p>Area lanuvina</p>
      </div>
      <div class="link-item">
        <a href="https://www.comune.lanuvio.rm.it" target="_blank">üìã Lanuvio</a>
        <p>Area lanuvina</p>
      </div>
    </div>
  </div>
 
  <!-- 7. COME FUNZIONA -->
  <div class="info-box">
    <h3>‚ÑπÔ∏è Come funziona questa pagina</h3>
    <p>
      Questa pagina raccoglie i <strong>link diretti alle fonti ufficiali</strong> dove vengono pubblicate 
      ordinanze, chiusure sentieri e tagli boschivi.
    </p>
    <p>
      Purtroppo non √® possibile aggregare automaticamente queste informazioni: le fonti sono tante, 
      strutturate in modo diverso e non sempre aggiornate in tempo reale. 
      Per questo il modo pi√π efficace per tenere informata la community √® 
      <strong>segnalare direttamente</strong> usando il form in cima alla pagina.
    </p>
    <p>
      <strong>Prima di ogni uscita</strong>, controlla:
    </p>
    <ul>
      <li>üì¢ Segnalazioni community (in cima a questa pagina)</li>
      <li>üìã Sito del Parco Castelli Romani (ordinanze ufficiali)</li>
      <li>üìú Albi Pretori dei comuni (autorizzazioni tagli boschivi)</li>
    </ul>
  </div>

 
  <!-- 8. CERCA NEGLI ALBI PRETORI -->
  <div class="section-box">
    <h3>üîç Come Cercare negli Albi Pretori</h3>
    <p>Gli albi pretori pubblicano ordinanze e autorizzazioni. Usa queste parole chiave:</p>
    <div class="keywords-box">
      <strong>Parole chiave utili:</strong>
      <ul>
        <li>"taglio" o "utilizzazione boschiva" ‚Üí per tagli programmati</li>
        <li>"chiusura sentiero" o "divieto transito" ‚Üí per chiusure temporanee</li>
        <li>"ordinanza" ‚Üí per provvedimenti ufficiali</li>
        <li>"lavori forestali" ‚Üí per manutenzioni in corso</li>
      </ul>
    </div>
  </div>
  
  <div styl